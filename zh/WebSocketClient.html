<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebSocketClient - WebSocket å®¢æˆ·ç«¯å°è£…ç±» | xxm-test-js</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="xxm-test-jsã€‚ä¸€ä¸ªå¼€ç®±å³ç”¨çš„å‡½æ•°åº“ã€‚æä¾›äº†æ—¥å¸¸å¼€å‘æ—¶æ‰€éœ€çš„ä¸€äº›å¸¸ç”¨å‡½æ•°æ–¹æ³•ã€‚è¯¥jsåº“æä¾›äº†ä¸°å¯Œçš„ä»£ç æç¤ºåŠŸèƒ½ï¼Œæ— éœ€é˜…è¯»æ–‡æ¡£ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿä½¿ç”¨ã€‚">
    
    <link rel="preload" href="/xxm-test-js/assets/css/0.styles.2c1b7aba.css" as="style"><link rel="preload" href="/xxm-test-js/assets/js/app.ef06d6fb.js" as="script"><link rel="preload" href="/xxm-test-js/assets/js/2.29230202.js" as="script"><link rel="preload" href="/xxm-test-js/assets/js/1.adb73c09.js" as="script"><link rel="preload" href="/xxm-test-js/assets/js/27.64423c08.js" as="script"><link rel="prefetch" href="/xxm-test-js/assets/js/10.acd366ff.js"><link rel="prefetch" href="/xxm-test-js/assets/js/11.2689ba83.js"><link rel="prefetch" href="/xxm-test-js/assets/js/12.137a9576.js"><link rel="prefetch" href="/xxm-test-js/assets/js/13.786f62b7.js"><link rel="prefetch" href="/xxm-test-js/assets/js/14.91be0496.js"><link rel="prefetch" href="/xxm-test-js/assets/js/15.9f59e3b5.js"><link rel="prefetch" href="/xxm-test-js/assets/js/16.47e1d84d.js"><link rel="prefetch" href="/xxm-test-js/assets/js/17.368b07ea.js"><link rel="prefetch" href="/xxm-test-js/assets/js/18.8241d824.js"><link rel="prefetch" href="/xxm-test-js/assets/js/19.56a0d05b.js"><link rel="prefetch" href="/xxm-test-js/assets/js/20.8f60a139.js"><link rel="prefetch" href="/xxm-test-js/assets/js/21.e21ffad3.js"><link rel="prefetch" href="/xxm-test-js/assets/js/22.3b50cedc.js"><link rel="prefetch" href="/xxm-test-js/assets/js/23.7e7f9a89.js"><link rel="prefetch" href="/xxm-test-js/assets/js/24.5f739fd0.js"><link rel="prefetch" href="/xxm-test-js/assets/js/25.3816f447.js"><link rel="prefetch" href="/xxm-test-js/assets/js/26.3ac48335.js"><link rel="prefetch" href="/xxm-test-js/assets/js/28.e67bfe17.js"><link rel="prefetch" href="/xxm-test-js/assets/js/29.3254cdd7.js"><link rel="prefetch" href="/xxm-test-js/assets/js/3.8af8fcbf.js"><link rel="prefetch" href="/xxm-test-js/assets/js/30.3eb11674.js"><link rel="prefetch" href="/xxm-test-js/assets/js/31.3e8b5b38.js"><link rel="prefetch" href="/xxm-test-js/assets/js/32.67b222d3.js"><link rel="prefetch" href="/xxm-test-js/assets/js/33.207f00ad.js"><link rel="prefetch" href="/xxm-test-js/assets/js/34.ccc576e2.js"><link rel="prefetch" href="/xxm-test-js/assets/js/35.98d88a6a.js"><link rel="prefetch" href="/xxm-test-js/assets/js/36.ea92def2.js"><link rel="prefetch" href="/xxm-test-js/assets/js/37.0daf274b.js"><link rel="prefetch" href="/xxm-test-js/assets/js/38.526e1e1e.js"><link rel="prefetch" href="/xxm-test-js/assets/js/39.ea9c7a5e.js"><link rel="prefetch" href="/xxm-test-js/assets/js/4.0471e9ae.js"><link rel="prefetch" href="/xxm-test-js/assets/js/40.04ad2926.js"><link rel="prefetch" href="/xxm-test-js/assets/js/41.3b72f631.js"><link rel="prefetch" href="/xxm-test-js/assets/js/42.44087614.js"><link rel="prefetch" href="/xxm-test-js/assets/js/43.eedff1ae.js"><link rel="prefetch" href="/xxm-test-js/assets/js/44.2cd97c4c.js"><link rel="prefetch" href="/xxm-test-js/assets/js/45.1296eb8f.js"><link rel="prefetch" href="/xxm-test-js/assets/js/46.21165e63.js"><link rel="prefetch" href="/xxm-test-js/assets/js/47.a6119b1d.js"><link rel="prefetch" href="/xxm-test-js/assets/js/48.3661bb40.js"><link rel="prefetch" href="/xxm-test-js/assets/js/49.28d5bb8c.js"><link rel="prefetch" href="/xxm-test-js/assets/js/5.842b4107.js"><link rel="prefetch" href="/xxm-test-js/assets/js/50.1e5569ea.js"><link rel="prefetch" href="/xxm-test-js/assets/js/51.37083dae.js"><link rel="prefetch" href="/xxm-test-js/assets/js/52.f7e48c65.js"><link rel="prefetch" href="/xxm-test-js/assets/js/53.c2ef81f5.js"><link rel="prefetch" href="/xxm-test-js/assets/js/54.90d6838b.js"><link rel="prefetch" href="/xxm-test-js/assets/js/55.ee17f74c.js"><link rel="prefetch" href="/xxm-test-js/assets/js/56.24d970b7.js"><link rel="prefetch" href="/xxm-test-js/assets/js/57.f6f6fc0b.js"><link rel="prefetch" href="/xxm-test-js/assets/js/58.17c68fad.js"><link rel="prefetch" href="/xxm-test-js/assets/js/59.be5c6e3f.js"><link rel="prefetch" href="/xxm-test-js/assets/js/6.9f813617.js"><link rel="prefetch" href="/xxm-test-js/assets/js/60.8ea703cc.js"><link rel="prefetch" href="/xxm-test-js/assets/js/61.543e835c.js"><link rel="prefetch" href="/xxm-test-js/assets/js/62.ba243393.js"><link rel="prefetch" href="/xxm-test-js/assets/js/63.974c8e3f.js"><link rel="prefetch" href="/xxm-test-js/assets/js/64.20dcd690.js"><link rel="prefetch" href="/xxm-test-js/assets/js/65.e062051e.js"><link rel="prefetch" href="/xxm-test-js/assets/js/66.697c0f28.js"><link rel="prefetch" href="/xxm-test-js/assets/js/67.afebc483.js"><link rel="prefetch" href="/xxm-test-js/assets/js/68.cbe5dcf4.js"><link rel="prefetch" href="/xxm-test-js/assets/js/69.8d33ea96.js"><link rel="prefetch" href="/xxm-test-js/assets/js/7.deca3814.js"><link rel="prefetch" href="/xxm-test-js/assets/js/vendors~docsearch.934ed2fb.js">
    <link rel="stylesheet" href="/xxm-test-js/assets/css/0.styles.2c1b7aba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xxm-test-js/" class="home-link router-link-active"><!----> <span class="site-name">xxm-test-js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xxm-test-js/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/xxm-test-js/zh/guide.html" class="nav-link">
  æŒ‡å—
</a></div><div class="nav-item"><a href="/xxm-test-js/zh/roadmap.html" class="nav-link">
  è·¯çº¿å›¾
</a></div><div class="nav-item"><a href="https://github.com/xuxiaomao123/xxm-test-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/xxm-test-js/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/xxm-test-js/zh/guide.html" class="nav-link">
  æŒ‡å—
</a></div><div class="nav-item"><a href="/xxm-test-js/zh/roadmap.html" class="nav-link">
  è·¯çº¿å›¾
</a></div><div class="nav-item"><a href="https://github.com/xuxiaomao123/xxm-test-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æŒ‡å—</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xxm-test-js/zh/guide.html" class="sidebar-link">æŒ‡å—</a></li><li><a href="/xxm-test-js/zh/roadmap.html" class="sidebar-link">ğŸ“‹ å¼€å‘è·¯çº¿å›¾</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å¸¸ç”¨æ–¹æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ—¶é—´æ–¹æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å­—ç¬¦ä¸²/æ•°å­—æ–¹æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•°ç»„/å¯¹è±¡æ–¹æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ»šåŠ¨æ–¹æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æµè§ˆå™¨æ–¹æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å¸¸ç”¨ç±»</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xxm-test-js/zh/TimeThread.html" class="sidebar-link">æ—¶é—´çº¿ç¨‹ç±»ï¼ˆTimeThreadï¼‰</a></li><li><a href="/xxm-test-js/zh/ScrollDirectionChecker.html" class="sidebar-link">æ»šåŠ¨æ–¹å‘æ£€æµ‹ç±»ï¼ˆScrollDirectionCheckerï¼‰</a></li><li><a href="/xxm-test-js/zh/FormValidator.html" class="sidebar-link">è¡¨å•éªŒè¯ç±»ï¼ˆFormValidatorï¼‰</a></li><li><a href="/xxm-test-js/zh/WebSocketClient.html" aria-current="page" class="active sidebar-link">WebSocketClient - WebSocket å®¢æˆ·ç«¯å°è£…ç±»</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#ç®€ä»‹" class="sidebar-link">ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#ä¸»è¦ç‰¹æ€§" class="sidebar-link">ä¸»è¦ç‰¹æ€§</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#å®‰è£…" class="sidebar-link">å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#åŸºæœ¬ç”¨æ³•" class="sidebar-link">åŸºæœ¬ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#é…ç½®é€‰é¡¹" class="sidebar-link">é…ç½®é€‰é¡¹</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#api-æ–¹æ³•" class="sidebar-link">API æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#ä½¿ç”¨ç¤ºä¾‹" class="sidebar-link">ä½¿ç”¨ç¤ºä¾‹</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#äº‹ä»¶è¯´æ˜" class="sidebar-link">äº‹ä»¶è¯´æ˜</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#æœ€ä½³å®è·µ" class="sidebar-link">æœ€ä½³å®è·µ</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#æ³¨æ„äº‹é¡¹" class="sidebar-link">æ³¨æ„äº‹é¡¹</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#æµè§ˆå™¨æ”¯æŒ" class="sidebar-link">æµè§ˆå™¨æ”¯æŒ</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#è®¸å¯è¯" class="sidebar-link">è®¸å¯è¯</a></li><li class="sidebar-sub-header"><a href="/xxm-test-js/zh/WebSocketClient.html#ç›¸å…³é“¾æ¥" class="sidebar-link">ç›¸å…³é“¾æ¥</a></li></ul></li><li><a href="/xxm-test-js/zh/Watermark.html" class="sidebar-link">Watermark - é¡µé¢æ°´å°ç±»</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="websocketclient-websocket-å®¢æˆ·ç«¯å°è£…ç±»"><a href="#websocketclient-websocket-å®¢æˆ·ç«¯å°è£…ç±»" class="header-anchor">#</a> WebSocketClient - WebSocket å®¢æˆ·ç«¯å°è£…ç±»</h1> <h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="header-anchor">#</a> ç®€ä»‹</h2> <p><code>WebSocketClient</code> æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ WebSocket å®¢æˆ·ç«¯å°è£…ç±»ï¼Œæä¾›äº†è‡ªåŠ¨é‡è¿ã€å¿ƒè·³æ£€æµ‹ã€æ¶ˆæ¯é˜Ÿåˆ—ã€äº‹ä»¶ç›‘å¬ç­‰å®ç”¨åŠŸèƒ½ã€‚é€‚ç”¨äºéœ€è¦å®æ—¶åŒå‘é€šä¿¡çš„åº”ç”¨åœºæ™¯ã€‚</p> <h2 id="ä¸»è¦ç‰¹æ€§"><a href="#ä¸»è¦ç‰¹æ€§" class="header-anchor">#</a> ä¸»è¦ç‰¹æ€§</h2> <ul><li>âœ… <strong>è‡ªåŠ¨é‡è¿</strong>ï¼šè¿æ¥æ–­å¼€åè‡ªåŠ¨å°è¯•é‡æ–°è¿æ¥ï¼Œå¯é…ç½®é‡è¿é—´éš”å’Œæœ€å¤§é‡è¿æ¬¡æ•°</li> <li>âœ… <strong>å¿ƒè·³æ£€æµ‹</strong>ï¼šå®šæ—¶å‘é€å¿ƒè·³åŒ…ä¿æŒè¿æ¥æ´»è·ƒï¼Œé˜²æ­¢è¿æ¥è¶…æ—¶</li> <li>âœ… <strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šè¿æ¥æœªå»ºç«‹æ—¶è‡ªåŠ¨ç¼“å­˜æ¶ˆæ¯ï¼Œè¿æ¥æˆåŠŸåè‡ªåŠ¨å‘é€</li> <li>âœ… <strong>æ™ºèƒ½é”™è¯¯å¤„ç†</strong>ï¼šè¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°åè‡ªåŠ¨æ¸…ç†é˜Ÿåˆ—ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</li> <li>âœ… <strong>äº‹ä»¶ç›‘å¬</strong>ï¼šæ”¯æŒç›‘å¬è¿æ¥ã€æ–­å¼€ã€æ¶ˆæ¯ã€é”™è¯¯ã€é‡è¿ç­‰äº‹ä»¶</li> <li>âœ… <strong>è¿æ¥çŠ¶æ€ç®¡ç†</strong>ï¼šæä¾›å®Œæ•´çš„è¿æ¥çŠ¶æ€è·Ÿè¸ªå’ŒæŸ¥è¯¢</li> <li>âœ… <strong>TypeScript æ”¯æŒ</strong>ï¼šå®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæ™ºèƒ½æç¤º</li> <li>âœ… <strong>è°ƒè¯•æ¨¡å¼</strong>ï¼šå¯é€‰çš„è°ƒè¯•æ—¥å¿—è¾“å‡º</li></ul> <h2 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> xxm-test-js
</code></pre></div><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="header-anchor">#</a> åŸºæœ¬ç”¨æ³•</h2> <h3 id="åˆ›å»ºå®ä¾‹"><a href="#åˆ›å»ºå®ä¾‹" class="header-anchor">#</a> åˆ›å»ºå®ä¾‹</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xxm-test-js'</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»º WebSocket å®¢æˆ·ç«¯å®ä¾‹</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketClient</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¿æ¥åˆ°æœåŠ¡å™¨</span>
ws<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å¸¦é…ç½®é€‰é¡¹çš„åˆ›å»º"><a href="#å¸¦é…ç½®é€‰é¡¹çš„åˆ›å»º" class="header-anchor">#</a> å¸¦é…ç½®é€‰é¡¹çš„åˆ›å»º</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketClient</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8080'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  reconnect<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// å¯ç”¨è‡ªåŠ¨é‡è¿</span>
  reconnectInterval<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token comment">// é‡è¿é—´éš” 3 ç§’</span>
  maxReconnectAttempts<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// æœ€å¤šé‡è¿ 10 æ¬¡</span>
  heartbeat<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// å¯ç”¨å¿ƒè·³æ£€æµ‹</span>
  heartbeatInterval<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// å¿ƒè·³é—´éš” 30 ç§’</span>
  heartbeatMessage<span class="token operator">:</span> <span class="token string">'ping'</span><span class="token punctuation">,</span> <span class="token comment">// å¿ƒè·³æ¶ˆæ¯å†…å®¹</span>
  connectionTimeout<span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token comment">// è¿æ¥è¶…æ—¶æ—¶é—´ 10 ç§’</span>
  debug<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// å¯ç”¨è°ƒè¯•æ—¥å¿—</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="é…ç½®é€‰é¡¹"><a href="#é…ç½®é€‰é¡¹" class="header-anchor">#</a> é…ç½®é€‰é¡¹</h2> <table><thead><tr><th>é€‰é¡¹</th> <th>ç±»å‹</th> <th>é»˜è®¤å€¼</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td><code>reconnect</code></td> <td><code>boolean</code></td> <td><code>true</code></td> <td>æ˜¯å¦å¯ç”¨è‡ªåŠ¨é‡è¿</td></tr> <tr><td><code>reconnectInterval</code></td> <td><code>number</code></td> <td><code>5000</code></td> <td>é‡è¿é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td></tr> <tr><td><code>maxReconnectAttempts</code></td> <td><code>number</code></td> <td><code>Infinity</code></td> <td>æœ€å¤§é‡è¿æ¬¡æ•°</td></tr> <tr><td><code>heartbeat</code></td> <td><code>boolean</code></td> <td><code>true</code></td> <td>æ˜¯å¦å¯ç”¨å¿ƒè·³æ£€æµ‹</td></tr> <tr><td><code>heartbeatInterval</code></td> <td><code>number</code></td> <td><code>30000</code></td> <td>å¿ƒè·³é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td></tr> <tr><td><code>heartbeatMessage</code></td> <td><code>string \| object</code></td> <td><code>'ping'</code></td> <td>å¿ƒè·³æ¶ˆæ¯å†…å®¹</td></tr> <tr><td><code>connectionTimeout</code></td> <td><code>number</code></td> <td><code>10000</code></td> <td>è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td></tr> <tr><td><code>protocols</code></td> <td><code>string \| string[]</code></td> <td><code>undefined</code></td> <td>WebSocket å­åè®®</td></tr> <tr><td><code>debug</code></td> <td><code>boolean</code></td> <td><code>false</code></td> <td>æ˜¯å¦å¯ç”¨è°ƒè¯•æ—¥å¿—</td></tr></tbody></table> <h2 id="api-æ–¹æ³•"><a href="#api-æ–¹æ³•" class="header-anchor">#</a> API æ–¹æ³•</h2> <h3 id="connect"><a href="#connect" class="header-anchor">#</a> connect()</h3> <p>å»ºç«‹ WebSocket è¿æ¥ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="disconnect-code-reason"><a href="#disconnect-code-reason" class="header-anchor">#</a> disconnect(code?, reason?)</h3> <p>å…³é—­ WebSocket è¿æ¥ã€‚</p> <p><strong>å‚æ•°ï¼š</strong></p> <ul><li><code>code</code> (å¯é€‰): å…³é—­çŠ¶æ€ç </li> <li><code>reason</code> (å¯é€‰): å…³é—­åŸå› </li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æˆ–æŒ‡å®šå…³é—­ç å’ŒåŸå› </span>
ws<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'æ­£å¸¸å…³é—­'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="send-data"><a href="#send-data" class="header-anchor">#</a> send(data)</h3> <p>å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨ã€‚æ”¯æŒå­—ç¬¦ä¸²ã€å¯¹è±¡ã€ArrayBufferã€Blob ç­‰ç±»å‹ã€‚</p> <p><strong>å‚æ•°ï¼š</strong></p> <ul><li><code>data</code>: è¦å‘é€çš„æ•°æ®</li></ul> <p><strong>è¡Œä¸ºè¯´æ˜ï¼š</strong></p> <ul><li>è¿æ¥å·²å»ºç«‹ï¼šç«‹å³å‘é€æ¶ˆæ¯</li> <li>è¿æ¥æœªå»ºç«‹ä½†æ­£åœ¨é‡è¿ï¼šæ¶ˆæ¯åŠ å…¥é˜Ÿåˆ—ï¼Œè¿æ¥æˆåŠŸåè‡ªåŠ¨å‘é€</li> <li>å·²è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°ï¼šæ‹’ç»å‘é€ï¼Œè§¦å‘ <code>error</code> äº‹ä»¶</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// å‘é€å­—ç¬¦ä¸²</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å‘é€å¯¹è±¡ï¼ˆè‡ªåŠ¨è½¬æ¢ä¸º JSONï¼‰</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'chat'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span> userId<span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å‘é€äºŒè¿›åˆ¶æ•°æ®</span>
<span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å¤„ç†å‘é€å¤±è´¥çš„æƒ…å†µ</span>
ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'æ— æ³•å‘é€æ¶ˆæ¯'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥å·²å¤±è´¥ï¼Œæ— æ³•å‘é€æ¶ˆæ¯'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="on-event-callback"><a href="#on-event-callback" class="header-anchor">#</a> on(event, callback)</h3> <p>ç›‘å¬äº‹ä»¶ã€‚</p> <p><strong>å‚æ•°ï¼š</strong></p> <ul><li><code>event</code>: äº‹ä»¶ç±»å‹ï¼ˆ'open' | 'close' | 'message' | 'error' | 'reconnect'ï¼‰</li> <li><code>callback</code>: äº‹ä»¶å›è°ƒå‡½æ•°</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥å·²å»ºç«‹'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ”¶åˆ°æ¶ˆæ¯:'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'å‘ç”Ÿé”™è¯¯:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥å·²å…³é—­:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>code<span class="token punctuation">,</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'reconnect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ­£åœ¨é‡è¿ï¼Œç¬¬'</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span>attempt<span class="token punctuation">,</span> <span class="token string">'æ¬¡å°è¯•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="off-event-callback"><a href="#off-event-callback" class="header-anchor">#</a> off(event, callback)</h3> <p>ç§»é™¤äº‹ä»¶ç›‘å¬ã€‚</p> <p><strong>å‚æ•°ï¼š</strong></p> <ul><li><code>event</code>: äº‹ä»¶ç±»å‹</li> <li><code>callback</code>: è¦ç§»é™¤çš„å›è°ƒå‡½æ•°</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">messageHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ”¶åˆ°æ¶ˆæ¯:'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> messageHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ç§»é™¤ç›‘å¬</span>
ws<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> messageHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="getreadystate"><a href="#getreadystate" class="header-anchor">#</a> getReadyState()</h3> <p>è·å–å½“å‰è¿æ¥çŠ¶æ€ç ã€‚</p> <p><strong>è¿”å›å€¼ï¼š</strong></p> <ul><li><code>0</code>: CONNECTINGï¼ˆæ­£åœ¨è¿æ¥ï¼‰</li> <li><code>1</code>: OPENï¼ˆå·²è¿æ¥ï¼‰</li> <li><code>2</code>: CLOSINGï¼ˆæ­£åœ¨å…³é—­ï¼‰</li> <li><code>3</code>: CLOSEDï¼ˆå·²å…³é—­ï¼‰</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> ws<span class="token punctuation">.</span><span class="token function">getReadyState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥çŠ¶æ€ç :'</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="getstatus"><a href="#getstatus" class="header-anchor">#</a> getStatus()</h3> <p>è·å–å½“å‰è¿æ¥çŠ¶æ€çš„ä¸­æ–‡æè¿°ã€‚</p> <p><strong>è¿”å›å€¼ï¼š</strong> <code>string</code></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> status <span class="token operator">=</span> ws<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥çŠ¶æ€:'</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡º: &quot;å·²è¿æ¥&quot;</span>
</code></pre></div><h3 id="destroy"><a href="#destroy" class="header-anchor">#</a> destroy()</h3> <p>é”€æ¯å®ä¾‹ï¼Œæ¸…ç†æ‰€æœ‰èµ„æºï¼ˆåŒ…æ‹¬å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ç­‰ï¼‰ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="header-anchor">#</a> ä½¿ç”¨ç¤ºä¾‹</h2> <h3 id="ç¤ºä¾‹-1-èŠå¤©åº”ç”¨"><a href="#ç¤ºä¾‹-1-èŠå¤©åº”ç”¨" class="header-anchor">#</a> ç¤ºä¾‹ 1ï¼šèŠå¤©åº”ç”¨</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xxm-test-js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ChatApp</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> ws<span class="token operator">:</span> WebSocketClient<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketClient</span><span class="token punctuation">(</span><span class="token string">'ws://chat.example.com/ws'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      reconnect<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      heartbeatInterval<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      debug<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">setupListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span><span class="token string">'åœ¨çº¿'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'chat'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">displayMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'âŒ è¿æ¥é”™è¯¯:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'âš ï¸ è¿æ¥å·²æ–­å¼€'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span><span class="token string">'ç¦»çº¿'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'reconnect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ğŸ”„ æ­£åœ¨é‡è¿... (ç¬¬ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>attempt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> æ¬¡å°è¯•)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'chat'</span><span class="token punctuation">,</span>
      message<span class="token operator">:</span> message<span class="token punctuation">,</span>
      timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">displayMessage</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">updateStatus</span><span class="token punctuation">(</span>status<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'çŠ¶æ€:'</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨</span>
<span class="token keyword">const</span> chat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chat<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'Hello, World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ç¤ºä¾‹-2-å®æ—¶æ•°æ®ç›‘æ§"><a href="#ç¤ºä¾‹-2-å®æ—¶æ•°æ®ç›‘æ§" class="header-anchor">#</a> ç¤ºä¾‹ 2ï¼šå®æ—¶æ•°æ®ç›‘æ§</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xxm-test-js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DataMonitor</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> ws<span class="token operator">:</span> WebSocketClient<span class="token punctuation">;</span>
  <span class="token keyword">private</span> dataHandlers<span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">Function</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketClient</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      reconnect<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      reconnectInterval<span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
      heartbeat<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      heartbeatMessage<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'ping'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleData</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è®¢é˜…æ•°æ®æµ</span>
  <span class="token function">subscribe</span><span class="token punctuation">(</span>dataType<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataHandlers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>dataType<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      action<span class="token operator">:</span> <span class="token string">'subscribe'</span><span class="token punctuation">,</span>
      dataType<span class="token operator">:</span> dataType<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// å–æ¶ˆè®¢é˜…</span>
  <span class="token function">unsubscribe</span><span class="token punctuation">(</span>dataType<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataHandlers<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>dataType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      action<span class="token operator">:</span> <span class="token string">'unsubscribe'</span><span class="token punctuation">,</span>
      dataType<span class="token operator">:</span> dataType<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">handleData</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataHandlers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">handler</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨</span>
<span class="token keyword">const</span> monitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataMonitor</span><span class="token punctuation">(</span><span class="token string">'ws://monitor.example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

monitor<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'temperature'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ¸©åº¦:'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token string">'Â°C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

monitor<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'humidity'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ¹¿åº¦:'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ç¤ºä¾‹-3-åœ¨-vue-3-ä¸­ä½¿ç”¨"><a href="#ç¤ºä¾‹-3-åœ¨-vue-3-ä¸­ä½¿ç”¨" class="header-anchor">#</a> ç¤ºä¾‹ 3ï¼šåœ¨ Vue 3 ä¸­ä½¿ç”¨</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>è¿æ¥çŠ¶æ€: {{ status }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>æ¶ˆæ¯åˆ—è¡¨:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg in messages<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ msg.content }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inputMessage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessage<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>å‘é€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xxm-test-js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ws <span class="token operator">=</span> ref<span class="token operator">&lt;</span>WebSocketClient <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'æœªè¿æ¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> messages <span class="token operator">=</span> ref<span class="token operator">&lt;</span>any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> inputMessage <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketClient</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8080'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ws<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    status<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'å·²è¿æ¥'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ws<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    status<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'å·²æ–­å¼€'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ws<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    messages<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">content</span><span class="token operator">:</span> data<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ws<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>inputMessage<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> ws<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>inputMessage<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    inputMessage<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="ç¤ºä¾‹-4-åœ¨-react-ä¸­ä½¿ç”¨"><a href="#ç¤ºä¾‹-4-åœ¨-react-ä¸­ä½¿ç”¨" class="header-anchor">#</a> ç¤ºä¾‹ 4ï¼šåœ¨ React ä¸­ä½¿ç”¨</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xxm-test-js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ChatComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>ws<span class="token punctuation">,</span> setWs<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>WebSocketClient <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> setStatus<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æœªè¿æ¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>input<span class="token punctuation">,</span> setInput<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketClient</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'å·²è¿æ¥'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'å·²æ–­å¼€'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token operator">...</span>prev<span class="token punctuation">,</span> data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setWs</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      client<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>input <span class="token operator">&amp;&amp;</span> ws<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setInput</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>çŠ¶æ€<span class="token operator">:</span> <span class="token punctuation">{</span>status<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>messages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>msg<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>input<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setInput</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
        onKeyPress<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>sendMessage<span class="token punctuation">}</span><span class="token operator">&gt;</span>å‘é€<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ChatComponent<span class="token punctuation">;</span>
</code></pre></div><h2 id="äº‹ä»¶è¯´æ˜"><a href="#äº‹ä»¶è¯´æ˜" class="header-anchor">#</a> äº‹ä»¶è¯´æ˜</h2> <h3 id="open-äº‹ä»¶"><a href="#open-äº‹ä»¶" class="header-anchor">#</a> open äº‹ä»¶</h3> <p>è¿æ¥æˆåŠŸå»ºç«‹æ—¶è§¦å‘ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥å·²å»ºç«‹'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="close-äº‹ä»¶"><a href="#close-äº‹ä»¶" class="header-anchor">#</a> close äº‹ä»¶</h3> <p>è¿æ¥å…³é—­æ—¶è§¦å‘ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> CloseEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥å…³é—­'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>code<span class="token punctuation">,</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="message-äº‹ä»¶"><a href="#message-äº‹ä»¶" class="header-anchor">#</a> message äº‹ä»¶</h3> <p>æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯æ—¶è§¦å‘ã€‚å¦‚æœæ¶ˆæ¯æ˜¯ JSON æ ¼å¼ï¼Œä¼šè‡ªåŠ¨è§£æã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ”¶åˆ°æ¶ˆæ¯:'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="error-äº‹ä»¶"><a href="#error-äº‹ä»¶" class="header-anchor">#</a> error äº‹ä»¶</h3> <p>å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚åŒ…æ‹¬è¿æ¥é”™è¯¯ã€å‘é€å¤±è´¥ã€è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°ç­‰æƒ…å†µã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'å‘ç”Ÿé”™è¯¯:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸ºé‡è¿å¤±è´¥</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'æ— æ³•å‘é€æ¶ˆæ¯'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'å·²è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°ï¼Œè¿æ¥å·²å¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¯ä»¥åœ¨æ­¤é€šçŸ¥ç”¨æˆ·æˆ–æ‰§è¡Œå…¶ä»–æ“ä½œ</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="reconnect-äº‹ä»¶"><a href="#reconnect-äº‹ä»¶" class="header-anchor">#</a> reconnect äº‹ä»¶</h3> <p>å¼€å§‹é‡è¿æ—¶è§¦å‘ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'reconnect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æ­£åœ¨ç¬¬ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>attempt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> æ¬¡é‡è¿</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="header-anchor">#</a> æœ€ä½³å®è·µ</h2> <h3 id="_1-åˆç†è®¾ç½®å¿ƒè·³é—´éš”"><a href="#_1-åˆç†è®¾ç½®å¿ƒè·³é—´éš”" class="header-anchor">#</a> 1. åˆç†è®¾ç½®å¿ƒè·³é—´éš”</h3> <p>æ ¹æ®æœåŠ¡å™¨çš„è¶…æ—¶è®¾ç½®æ¥é…ç½®å¿ƒè·³é—´éš”ï¼Œä¸€èˆ¬å»ºè®®è®¾ç½®ä¸ºæœåŠ¡å™¨è¶…æ—¶æ—¶é—´çš„ 1/2 æˆ– 2/3ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketClient</span><span class="token punctuation">(</span><span class="token string">'ws://example.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  heartbeatInterval<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 30 ç§’</span>
  heartbeatMessage<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'ping'</span><span class="token punctuation">,</span> timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-å¤„ç†é‡è¿é€»è¾‘"><a href="#_2-å¤„ç†é‡è¿é€»è¾‘" class="header-anchor">#</a> 2. å¤„ç†é‡è¿é€»è¾‘</h3> <p>åœ¨é‡è¿æ—¶å¯èƒ½éœ€è¦é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯æˆ–è®¢é˜…æ•°æ®ã€‚å»ºè®®ç›‘å¬é‡è¿å¤±è´¥äº‹ä»¶ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// å‘é€è®¤è¯ä¿¡æ¯</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'auth'</span><span class="token punctuation">,</span>
    token<span class="token operator">:</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// é‡æ–°è®¢é˜…æ•°æ®</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'subscribe'</span><span class="token punctuation">,</span>
    channels<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'channel1'</span><span class="token punctuation">,</span> <span class="token string">'channel2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬é‡è¿å¤±è´¥</span>
ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'æ— æ³•å‘é€æ¶ˆæ¯'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å·²è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¯ä»¥æ˜¾ç¤ºé‡è¿æŒ‰é’®è®©ç”¨æˆ·æ‰‹åŠ¨é‡è¿</span>
    <span class="token function">showReconnectButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"><a href="#_3-ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—" class="header-anchor">#</a> 3. ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h3> <p>åœ¨è¿æ¥å»ºç«‹ä¹‹å‰å‘é€çš„æ¶ˆæ¯ä¼šè‡ªåŠ¨åŠ å…¥é˜Ÿåˆ—ï¼Œè¿æ¥æˆåŠŸåè‡ªåŠ¨å‘é€ã€‚</p> <p><strong>æ³¨æ„ï¼š</strong> å¦‚æœè¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šè¢«è‡ªåŠ¨æ¸…ç©ºä»¥é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œåç»­å‘é€çš„æ¶ˆæ¯ä¼šè¢«æ‹’ç»ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketClient</span><span class="token punctuation">(</span><span class="token string">'ws://example.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  maxReconnectAttempts<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// è®¾ç½®æœ€å¤§é‡è¿æ¬¡æ•°</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å³ä½¿è¿æ¥è¿˜æœªå»ºç«‹ï¼Œæ¶ˆæ¯ä¹Ÿä¼šè¢«åŠ å…¥é˜Ÿåˆ—</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'message'</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'Hello'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬å‘é€å¤±è´¥</span>
ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'æ— æ³•å‘é€æ¶ˆæ¯'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é‡è¿å¤±è´¥åçš„æ¶ˆæ¯ä¼šè§¦å‘æ­¤é”™è¯¯</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œè¿æ¥å·²æ–­å¼€'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-åŠæ—¶æ¸…ç†èµ„æº"><a href="#_4-åŠæ—¶æ¸…ç†èµ„æº" class="header-anchor">#</a> 4. åŠæ—¶æ¸…ç†èµ„æº</h3> <p>åœ¨ç»„ä»¶å¸è½½æˆ–é¡µé¢å…³é—­æ—¶ï¼Œè®°å¾—è°ƒç”¨ <code>destroy()</code> æ–¹æ³•æ¸…ç†èµ„æºã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// åœ¨ç»„ä»¶å¸è½½æ—¶</span>
<span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æˆ–åœ¨ beforeunload äº‹ä»¶ä¸­</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-é”™è¯¯å¤„ç†"><a href="#_5-é”™è¯¯å¤„ç†" class="header-anchor">#</a> 5. é”™è¯¯å¤„ç†</h3> <p>æ·»åŠ å®Œå–„çš„é”™è¯¯å¤„ç†é€»è¾‘ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'WebSocket é”™è¯¯:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å‘é€é”™è¯¯æ—¥å¿—åˆ°ç›‘æ§ç³»ç»Ÿ</span>
  <span class="token function">sendErrorLog</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// éæ­£å¸¸å…³é—­</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'è¿æ¥å¼‚å¸¸å…³é—­:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>code<span class="token punctuation">,</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="header-anchor">#</a> æ³¨æ„äº‹é¡¹</h2> <ol><li><strong>æµè§ˆå™¨å…¼å®¹æ€§</strong>ï¼šWebSocket API åœ¨æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä¸­éƒ½å¾—åˆ°æ”¯æŒï¼Œä½†åœ¨æ—§ç‰ˆæœ¬æµè§ˆå™¨ä¸­å¯èƒ½ä¸å¯ç”¨ã€‚</li> <li><strong>è¿æ¥é™åˆ¶</strong>ï¼šæµè§ˆå™¨å¯¹åŒä¸€åŸŸåçš„ WebSocket è¿æ¥æ•°é‡æœ‰é™åˆ¶ï¼Œé€šå¸¸ä¸º 6-8 ä¸ªã€‚</li> <li><strong>è·¨åŸŸé—®é¢˜</strong>ï¼šWebSocket è¿æ¥å—åŒæºç­–ç•¥é™åˆ¶ï¼ŒæœåŠ¡å™¨éœ€è¦æ­£ç¡®é…ç½® CORSã€‚</li> <li><strong>å®‰å…¨æ€§</strong>ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ <code>wss://</code>ï¼ˆWebSocket Secureï¼‰åè®®ã€‚</li> <li><strong>æ¶ˆæ¯å¤§å°</strong>ï¼šé¿å…å‘é€è¿‡å¤§çš„æ¶ˆæ¯ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–è¿æ¥ä¸­æ–­ã€‚</li> <li><strong>é‡è¿å¤±è´¥å¤„ç†</strong>ï¼šè¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°åï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šè¢«è‡ªåŠ¨æ¸…ç©ºï¼Œåç»­ <code>send()</code> è°ƒç”¨ä¼šè§¦å‘ <code>error</code> äº‹ä»¶ã€‚å»ºè®®ç›‘å¬æ­¤äº‹ä»¶å¹¶æä¾›ç”¨æˆ·åé¦ˆã€‚</li> <li><strong>å†…å­˜ç®¡ç†</strong>ï¼šé•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨åº”åˆç†è®¾ç½® <code>maxReconnectAttempts</code>ï¼Œé¿å…æ— é™é‡è¿å¯¼è‡´èµ„æºæµªè´¹ã€‚</li></ol> <h2 id="æµè§ˆå™¨æ”¯æŒ"><a href="#æµè§ˆå™¨æ”¯æŒ" class="header-anchor">#</a> æµè§ˆå™¨æ”¯æŒ</h2> <ul><li>Chrome 16+</li> <li>Firefox 11+</li> <li>Safari 7+</li> <li>Edge 12+</li> <li>Opera 12.1+</li> <li>IE 10+</li></ul> <h2 id="è®¸å¯è¯"><a href="#è®¸å¯è¯" class="header-anchor">#</a> è®¸å¯è¯</h2> <p>MIT</p> <h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="header-anchor">#</a> ç›¸å…³é“¾æ¥</h2> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket" target="_blank" rel="noopener noreferrer">MDN WebSocket API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://tools.ietf.org/html/rfc6455" target="_blank" rel="noopener noreferrer">WebSocket åè®® RFC 6455<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/xxm-test-js/zh/FormValidator.html" class="prev">
        è¡¨å•éªŒè¯ç±»ï¼ˆFormValidatorï¼‰
      </a></span> <span class="next"><a href="/xxm-test-js/zh/Watermark.html">
        Watermark - é¡µé¢æ°´å°ç±»
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/xxm-test-js/assets/js/app.ef06d6fb.js" defer></script><script src="/xxm-test-js/assets/js/2.29230202.js" defer></script><script src="/xxm-test-js/assets/js/1.adb73c09.js" defer></script><script src="/xxm-test-js/assets/js/27.64423c08.js" defer></script>
  </body>
</html>
